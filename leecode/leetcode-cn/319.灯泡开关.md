# 寻找规律

第 1 次：位置位于 1 的倍数的灯状态变化；

第 2 次：位置位于 2 的倍数的灯状态变化；

……

第 n 次：位置位于 n 的倍数的灯状态变化。



换个角度，位于第 k 个位置的灯，在 n 次操作中，状态变化总次数为 k 的约数次。

如果 k 的约数的个数为偶数，那么最终状态就是暗，反之为亮。

又因为如果 x 是 k 的一个约数，那么 x/k 一定也是 k 的约数，只有当 k 与 x/k 相等时，才只会出现一次。也就是只有 k 是完全平方数的情况下，状态变换次数才会是奇数次。

于是，本题最终转化为

> 求 $1,2,...,n$ 中的完全平方数的个数。



#  $1,2,...,n$ 中的完全平方数的个数：

假设 $1,2,...,n$ 的完全平方数的个数为 $k$ ，那么 $n$ 必定处于以下地位：
$$
1^2,2^2,...,k^2,...,n,(k+1)^2
$$
于是有
$$
k^2\le n\lt (k+1)^2
$$
得
$$
k=\lfloor\sqrt{n}\rfloor
$$


# 浮点数的精度问题：

由于 `sqrt(n)` 是一个浮点数函数，可能有精度丧失，导致结果错误，例如 $\lfloor\sqrt{4.0}\rfloor=\lfloor1.9999999999\rfloor=1$。

由
$$
k^2 \le n \lt k+1
$$
对 $\forall$ 非负数 $\Delta$ ，有
$$
k^2+\Delta \le n+\Delta \lt (k+1)^2
$$
那么
$$
\lfloor \sqrt{n+\Delta} \rfloor = k = \lfloor \sqrt{n} \rfloor
$$
满足条件。

我们希望找出 $\Delta$ 的最大值。

得
$$
k^2+\Delta \lt (k+1)^2
$$
 得
$$
\Delta < 2k+1
$$
因为 $k$ 为自然数 $0,1,2,...$ ，令 $k=0$，得
$$
\Delta < 1
$$
综上，只要 $\Delta$ 不超过 1 即可满足条件。

